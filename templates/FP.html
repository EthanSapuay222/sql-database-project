{% extends 'base.html' %}

{% block title %}EcoTrack Home{% endblock %}

{% block head %}
<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          "image-bg": "#FFFBF0",
          "image-header-bg": "#A0B0A0",
          "image-sidebar-bg": "#A0B0A0",
          "footer-brown": "#B86E28",
          "button-main-bg": "#6B8E23",
          "button-main-hover": "#556B2F",
          "image-text-light": "#FFFFFF",
          "image-text-dark": "#36454F",
          "image-link-text": "#FFFFFF",
          "image-logo-bg": "#6B8E23",
          "map-border": "#6B8E23",
        },
      },
    },
  };
</script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/FP.css') }}" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/map.css') }}" />
{% endblock %}

{% block content %}
<div id="app-container" class="min-h-screen flex flex-col">
  <header class="bg-image-header-bg p-4 flex justify-between items-center shadow-lg">
    <div class="flex items-center space-x-3">
      <div class="bg-image-logo-bg w-10 h-10 rounded-full flex items-center justify-center border-2 border-white">
        <img src="{{ url_for('static', filename='img/EcotrackLogo.png') }}" class="w-full h-full object-cover rounded-full" alt="EcoTrack Logo" />
      </div>
      <span class="text-image-text-dark font-extrabold text-2xl tracking-wider">EcoTrack</span>
    </div>
    <div>
      <a href="{{ url_for('logout') }}" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition duration-150">Logout</a>
    </div>
  </header>

  <div class="flex flex-1">
    <nav id="sidebar-nav" class="w-64 bg-image-sidebar-bg p-4 flex flex-col space-y-2 shadow-xl hidden md:flex">
      <ul class="space-y-2">
        <li>
          <a href="{{ url_for('species_view') }}" class="bg-button-main-bg text-image-text-light p-3 flex items-center rounded-lg hover:bg-button-main-hover transition duration-150 font-medium shadow-md">
            <span class="text-xl mr-2">→</span> View Life on Land & Water
          </a>
        </li>
        <li>
          <a href="{{ url_for('dashboard_view') }}" class="bg-button-main-bg text-image-text-light p-3 flex items-center rounded-lg hover:bg-button-main-hover transition duration-150 font-medium shadow-md">
            <span class="text-xl mr-2">→</span> Environmental Dashboard
          </a>
        </li>
        <li>
          <a href="{{ url_for('submission_report_view') }}" class="bg-button-main-bg text-image-text-light p-3 flex items-center rounded-lg hover:bg-button-main-hover transition duration-150 font-medium shadow-md">
            <span class="text-xl mr-2">→</span> Submission Report
          </a>
        </li>
        <li>
          <a href="{{ url_for('map_view') }}" class="bg-button-main-bg text-image-text-light p-3 flex items-center rounded-lg hover:bg-button-main-hover transition duration-150 font-medium shadow-md" target="_blank" rel="noopener noreferrer">
            <span class="text-xl mr-2">→</span> Interactive Map
          </a>
        </li>
        <li>
          <a href="{{ url_for('about_view') }}" class="bg-button-main-bg text-image-text-light p-3 flex items-center rounded-lg hover:bg-button-main-hover transition duration-150 font-medium shadow-md">
            <span class="text-xl mr-2">→</span> About Us
          </a>
        </li>
      </ul>
    </nav>

    <main id="main-content" class="flex-1 p-8">
      <div class="text-center">
        <h2 class="text-2xl font-semibold italic text-image-text-dark mb-2">"Track Change, Make Impact"</h2>
        <p class="text-lg text-image-text-dark font-medium mb-16">Environmental Awareness & Progress Tracker for Batangas</p>
      </div>
      <div class="bg-green-700 p-8 rounded-lg shadow-lg mb-8 text-white max-w-4xl mx-auto">
        <h3 class="text-2xl font-semibold mb-4">SDG 14: Life Below Water</h3>
        <p class="text-lg leading-relaxed">Healthy oceans and seas are essential to our existence. They cover 70 percent of our planet and we rely on them for food, energy and water. Yet, we have managed to do tremendous damage to these precious resources. We must protect them by eliminating pollution and overfishing and immediately start to responsibly manage and protect all marine life around the world.</p>
      </div>

      <div class="bg-green-700 p-8 rounded-lg shadow-lg text-white max-w-4xl mx-auto">
        <h3 class="text-2xl font-semibold mb-4">SDG 15: Life On Land</h3>
        <p class="text-lg leading-relaxed">A flourishing life on land is the foundation for our life on this planet. We are all part of the planet's ecosystem and we have caused severe damage to it through deforestation, loss of natural habitats and land degradation. Promoting a sustainable use of our ecosystems and preserving biodiversity is not a cause. It is the key to our own survival.</p>
      </div>
    </main>
  </div>

  <section class="p-8 border-t border-map-border bg-image-bg">
    <div class="container mx-auto flex flex-col items-center">
      <h3 class="text-2xl font-bold mb-4 text-image-sidebar-bg">Environmental Reports Across Batangas (Map Preview)</h3>
      <div id="fp-map-container" class="w-full max-w-4xl h-96 border-4 border-map-border rounded-xl overflow-hidden shadow-lg"></div>
      <a href="{{ url_for('map_view') }}" class="mt-6 inline-block">
        <button type="button" class="bg-button-main-bg text-white px-8 py-3 rounded-full text-lg font-semibold shadow-md hover:bg-button-main-hover transition duration-150">View Full Map</button>
      </a>
    </div>
  </section>

  <footer class="bg-footer-brown text-white py-10 w-full">
    <div class="container mx-auto flex flex-col items-center text-center space-y-4">
      <div class="flex items-center space-x-2">
        <div class="bg-teal-400 rounded-full p-1">
          <img src="{{ url_for('static', filename='img/EcotrackLogo.png') }}" alt="EcoTrack" class="w-8 h-8 rounded-full object-cover" />
        </div>
        <span class="text-2xl font-bold">EcoTrack</span>
      </div>
      <h2 class="text-xl font-bold italic">"Track Change, Make Impact"</h2>
      <div class="text-sm space-y-1">
        <p>&copy; 2025 Group 5 – DBMS & Advance Computer Programing School Project</p>
        <p class="font-bold">Created by: Sapuay | Semira | Caguimbal | De Chavez</p>
      </div>
      <a href="{{ url_for('resources_view') }}" class="text-white italic hover:underline flex items-center font-semibold mt-4">
        Resources & Credits
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" class="w-5 h-5 ml-2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
        </svg>
      </a>
    </div>
  </footer>
</div>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
(function() {
  // Wait for DOM to be ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMap);
  } else {
    initMap();
  }

  function initMap() {
    var mapContainer = document.getElementById('fp-map-container');
    if (!mapContainer) return;

    var SEVERITY_COLORS = {
      'Low': '#4CAF50',
      'Medium': '#FF9800',
      'High': '#F44336',
      'Critical': '#D92D2D'
    };

    var BATANGAS_CENTER = [13.8595, 120.978];
    var fpMap = L.map('fp-map-container').setView(BATANGAS_CENTER, 10);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(fpMap);

    // Load location data from API
    fetch('/api/locations')
      .then(function(response) {
        if (!response.ok) throw new Error('API request failed');
        return response.json();
      })
      .then(function(result) {
        if (result.success && result.data && Array.isArray(result.data)) {
          result.data.forEach(function(location) {
            if (!location.latitude || !location.longitude) return;
            
            var lat = parseFloat(location.latitude);
            var lon = parseFloat(location.longitude);
            if (isNaN(lat) || isNaN(lon)) return;

            var severity = location.severity_level || 'Low';
            var color = SEVERITY_COLORS[severity] || '#3f51b5';
            
            var html = '<div class="severity-pin" style="background-color: ' + color + '"><span class="severity-pin__dot"></span></div>';
            
            var icon = L.divIcon({
              className: 'severity-pin-wrapper',
              html: html,
              iconSize: [30, 30],
              iconAnchor: [15, 30],
              popupAnchor: [0, -28]
            });

            var cityName = location.city_name || 'Unknown';
            var totalReports = location.total_reports || 0;
            
            var popupContent = '<div class="p-2">' +
              '<h4 class="font-bold text-lg">' + cityName + '</h4>' +
              '<p class="text-sm">Total Reports: <span class="font-bold">' + totalReports + '</span></p>' +
              '<p class="text-sm">Severity: <span class="font-bold" style="color: ' + color + ';">' + severity + '</span></p>' +
              '</div>';

            L.marker([lat, lon], { icon: icon })
              .bindPopup(popupContent)
              .addTo(fpMap);
          });
        }
      })
      .catch(function(error) {
        console.error('Error loading map pins:', error);
      });
  }
})();
</script>
{% endblock %}
